(function(e){var t=e("#variants-holder"),n,r,i=e("#product_image_gallery"),s=e("#product_images_container ul.product_images"),o={init:function(){product_type="simple";e(".product-edit-container").on("click","._discounted_price",this.showDiscount);e(".product-edit-container").on("click","a.sale-schedule",this.showDiscountSchedule);e(".product-edit-container").on("click","input[type=checkbox]#_downloadable",this.downloadable);e(".product-edit-container").on("change","#_product_type",this.onChangeProductType);e("#product-attributes").on("click",".add-variant-category",this.variants.addCategory);e("#variants-holder").on("click",".box-header .row-remove",this.variants.removeCategory);e("#variants-holder").on("click",".item-action a.row-add",this.variants.addItem);e("#variants-holder").on("click",".item-action a.row-remove",this.variants.removeItem);e("#variable_product_options").on("click",".sale_schedule",this.variants.saleSchedule);e("#variable_product_options").on("click",".cancel_sale_schedule",this.variants.cancelSchedule);e("#variable_product_options").on("woocommerce_variations_added",this.variants.onVariantAdded);this.variants.dates();this.variants.initSaleSchedule();e(".save_attributes").on("click",this.variants.save);e("#dokan-product-images").on("click","a.add-product-images",this.gallery.addImages);e("#dokan-product-images").on("click","a.delete",this.gallery.deleteImage);this.gallery.sortable();e(".product-edit-container").on("click","a.dokan-feat-image-btn",this.featuredImage.addImage);e(".product-edit-container").on("click","a.dokan-remove-feat-image",this.featuredImage.removeImage);e(".product-edit-container").on("click","a.upload_file_button",this.fileDownloadable);e(".dokan-toggle-sidebar").on("click","a.dokan-toggle-edit",this.sidebarToggle.showStatus);e(".dokan-toggle-sidebar").on("click","a.dokan-toggle-save",this.sidebarToggle.saveStatus);e(".dokan-toggle-sidebar").on("click","a.dokan-toggle-cacnel",this.sidebarToggle.cancel);e(".product-edit-container").on("click","a.insert-file-row",function(){e(this).closest("table").find("tbody").append(e(this).data("row"));return!1});e(".product-edit-container").on("click","a.delete",function(){e(this).closest("tr").remove();return!1})},showDiscount:function(){var t=e(this),n=t.is(":checked"),r=e(".special-price-container");n?r.removeClass("dokan-hide"):r.addClass("dokan-hide")},showDiscountSchedule:function(t){t.preventDefault();e(".sale-schedule-container").slideToggle("fast")},onChangeProductType:function(){var t=e("#_product_type").val();if(t==="simple"){product_type="simple";e("aside.downloadable").removeClass("dokan-hide");e(".show_if_variable").addClass("dokan-hide");e(".show_if_simple").removeClass("dokan-hide")}else{product_type="variable";e("aside.downloadable").addClass("dokan-hide");e(".show_if_variable").removeClass("dokan-hide");e(".show_if_simple").addClass("dokan-hide")}},downloadable:function(){e(this).prop("checked")?e(this).closest("aside").find(".dokan-side-body").removeClass("dokan-hide"):e(this).closest("aside").find(".dokan-side-body").addClass("dokan-hide")},variants:{addCategory:function(n){n.preventDefault();var r=e(".inputs-box").length,i=_.template(e("#tmpl-sc-category").html(),{row:r});t.append(i).children(":last").hide().fadeIn();product_type==="simple"&&t.find(".show_if_variable").hide()},removeCategory:function(t){t.preventDefault();confirm("Sure?")&&e(this).parents(".inputs-box").fadeOut(function(){e(this).remove()})},addItem:function(t){t.preventDefault();var n=e(this),r=n.closest(".inputs-box"),i=n.closest("ul.option-couplet"),s=i.find("li").length,o=r.data("count"),u=_.template(e("#tmpl-sc-category-item").html());n.closest("li").after(u({row:o,col:s}))},removeItem:function(t){t.preventDefault();var n=e(this).parents("ul").find("li");n.length>1&&e(this).parents("li").fadeOut(function(){e(this).remove()})},save:function(){var t={post_id:e(this).data("id"),data:e(".woocommerce_attributes").find("input, select, textarea").serialize(),action:"dokan_save_attributes"},n=window.location.toString();e("#variants-holder").block({message:null,overlayCSS:{background:"#fff",opacity:.6}});e.post(ajaxurl,t,function(t){console.log(t);e("#variable_product_options").block({message:null,overlayCSS:{background:"#fff",opacity:.6}});e("#variable_product_options").load(n+" #variable_product_options_inner",function(){e("#variable_product_options").unblock()});e("input.variable_is_downloadable, input.variable_is_virtual").trigger("change");e("#variants-holder").unblock()})},initSaleSchedule:function(){e(".sale_price_dates_fields").each(function(){var t=e(this),n=!1,r=t.closest("div, table");t.find("input").each(function(){e(this).val()!=""&&(n=!0)});if(n){r.find(".sale_schedule").hide();r.find(".sale_price_dates_fields").show()}else{r.find(".sale_schedule").show();r.find(".sale_price_dates_fields").hide()}})},saleSchedule:function(){var t=e(this).closest("div, table");e(this).hide();t.find(".cancel_sale_schedule").show();t.find(".sale_price_dates_fields").show();return!1},cancelSchedule:function(){var t=e(this).closest("div, table");e(this).hide();t.find(".sale_schedule").show();t.find(".sale_price_dates_fields").hide();t.find(".sale_price_dates_fields").find("input").val("");return!1},dates:function(){var t=e(".sale_price_dates_fields input").datepicker({defaultDate:"",dateFormat:"yy-mm-dd",numberOfMonths:1,onSelect:function(n){var r=e(this).is("#_sale_price_dates_from, .sale_price_dates_from")?"minDate":"maxDate",i=e(this).data("datepicker"),s=e.datepicker.parseDate(i.settings.dateFormat||e.datepicker._defaults.dateFormat,n,i.settings);t.not(this).datepicker("option",r,s)}})},onVariantAdded:function(){o.variants.dates()}},gallery:{addImages:function(e){e.preventDefault();var t=i.val();if(n){n.open();return}n=wp.media.frames.downloadable_file=wp.media({title:"Add Images to Product Gallery",button:{text:"Add to gallery"},multiple:!0});n.on("select",function(){var e=n.state().get("selection");e.map(function(e){e=e.toJSON();if(e.id){t=t?t+","+e.id:e.id;s.append('                                <li class="image" data-attachment_id="'+e.id+'">                                    <img src="'+e.url+'" />                                    <ul class="actions">                                        <li><a href="#" class="delete" title="Delete image">Delete</a></li>                                    </ul>                                </li>')}});i.val(t)});n.open()},deleteImage:function(t){t.preventDefault();e(this).closest("li.image").remove();var n="";e("#product_images_container ul li.image").css("cursor","default").each(function(){var t=e(this).attr("data-attachment_id");n=n+t+","});i.val(n);return!1},sortable:function(){s.sortable({items:"li.image",cursor:"move",scrollSensitivity:40,forcePlaceholderSize:!0,forceHelperSize:!1,helper:"clone",opacity:.65,placeholder:"dokan-sortable-placeholder",start:function(e,t){t.item.css("background-color","#f6f6f6")},stop:function(e,t){t.item.removeAttr("style")},update:function(t,n){var r="";e("#product_images_container ul li.image").css("cursor","default").each(function(){var e=jQuery(this).attr("data-attachment_id");r=r+e+","});i.val(r)}})}},featuredImage:{addImage:function(t){t.preventDefault();var n=e(this);if(r){r.open();return}r=wp.media({title:"Upload featured image",button:{text:"Set featured image"}});r.on("select",function(){var e=r.state().get("selection");e.map(function(e){e=e.toJSON();console.log(e,n);n.siblings("input.dokan-feat-image-id").val(e.id);var t=n.closest(".instruction-inside"),r=t.siblings(".image-wrap");r.find("img").attr("src",e.url);t.addClass("dokan-hide");r.removeClass("dokan-hide")})});r.open()},removeImage:function(t){t.preventDefault();var n=e(this),r=n.closest(".image-wrap"),i=r.siblings(".instruction-inside");i.find("input.dokan-feat-image-id").val("0");r.addClass("dokan-hide");i.removeClass("dokan-hide")}},fileDownloadable:function(t){t.preventDefault();var n=e(this),r;if(r){r.open();return}r=wp.media({title:"Choose a file",button:{text:"Insert file URL"},multiple:!0});r.on("select",function(){var e=r.state().get("selection");e.map(function(e){e=e.toJSON();n.closest("tr").find("input.wc_file_url").val(e.url)})});r.open()},sidebarToggle:{showStatus:function(t){var n=e(this).siblings(".dokan-toggle-select-container");if(n.is(":hidden")){n.slideDown("fast");e(this).hide()}return!1},saveStatus:function(t){var n=e(this).closest(".dokan-toggle-select-container");n.slideUp("fast");n.siblings("a.dokan-toggle-edit").show();var r=e("option:selected",n.find("select.dokan-toggle-select")).text();n.siblings(".dokan-toggle-selected-display").html(r);return!1},cancel:function(t){var n=e(this).closest(".dokan-toggle-select-container");n.slideUp("fast");n.siblings("a.dokan-toggle-edit").show();return!1}}};e(function(){o.init();e("#_product_type").trigger("change")})})(jQuery);